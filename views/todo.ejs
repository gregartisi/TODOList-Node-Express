<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script><!--Jquery-->
<script src="/socket.io/socket.io.js"></script><!--socket io pour communiquer via websocket-->
<link rel="stylesheet" href="/todo.css">
<script>var socket = io.connect('http://localhost:8080/');<!--conexion au serveur--><script>
  
//fonction qui crée un champ de taxte editable à la place de la task
			 function makeEditable(task,text){
			   console.log(task);
				
				var h = '<form name="edit" action="/todo/edit" method="POST"><input type="text" id="newText" name="newText" value="'+text+'"><input type="button" onclick="save(\''+task+'\',\''+text+'\');" value="OK"></form>';
				
				var node= '#span'+task;
				$(node).html(h);
			 }
			 
			 //fonction qui envoie la tache à mettre à jour au serveur, pour cela on utilise socket io
			 function save(task,text){
				socket.emit('edit', {'task':task,'textT':text});
				
			 }
			 function add(text){
				socket.emit('add', text);
			 }
			 function remove(task){
				socket.emit('remove', task);
			 }
			 
			 socket.on('task', function(todo) {
				console.log(todo.texte);
				line = '<li id="li'+todo.num+'"><span id="span'+todo.num+'">'+todo.texte+'</span> <a href="#" onclick="remove('+todo.num+')"  id="check">&check;</a> </li>';
                $('#liste').append(line);
				$('#taskNum').html(todo.count+" tâches à executer:");
            })
			socket.on('del', function(task) {
				
				line = '#li'+task.task;
				$(line).remove();
				$('#taskNum').html(task.count+" tâches à executer:");
            })
</script>
 <div id="page">
<h1>To do list:</h1>

<div id="todo">
		
		<% if(locals.todo){%>
		<h3 id="taskNum"><%=todo.size%> tâches à executer:</h3>
		<ul id="liste">

		<% for(let [key, value] of todo) { %>
			<li id="li<%=key%>"><span id='span<%=key%>'><%=value%></span>  <a href="#" onclick="remove(<%=key%>)"  id="check">&check;</a> </li> 
		<% } %>
		</ul>
		<% }%>
</div>
 <label for="Addtodo"><img src="/pluspt1.jpg"> AJOUTER UNE TACHE:</label> <input type="text" id="Addtodo" name="todo">
	<input type="submit" value="add" class="submit" onclick="add($('#Addtodo').val());">
 
</div>